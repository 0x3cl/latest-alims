<div class="page-wrapper">
    <div class="main-container">
        <?php include(APPPATH . '/Views/Student/templates/sidebar.php'); ?>
        <div class="app-container">
            <?php include(APPPATH . '/Views/Student/templates/navbar.php'); ?>
            <div class="app-hero-header d-flex align-items-center">
                <ol class="breadcrumb d-none d-lg-flex">
                    <li class="breadcrumb-item">
                        <i class="bi bi-house lh-1"></i>
                        <a href="index.html" class="text-decoration-none">Home</a>
                    </li>
                    <li class="breadcrumb-item text-secondary" aria-current="page">
                        Me
                    </li>
                </ol>
            </div>
            <div class="app-body">
                <div class="banner">
                    <div class="banner-overlay">
                    </div>
                    <div class="banner-image">
                            
                    </div>
                </div>
                <div class="profile-details">
                    <div class="d-block d-md-flex align-items-center gap-4 position-relative">
                         <div class="profile-container" id="profile-image">

                        </div>
                        <div class="profile-info" id="profile-info">
                            <ul class="list-unstyled skeleton-loading">
                                <li class="list-unstyled-item">
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="w-100">
                                            <div class="skeleton-text sm-w"></div>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-unstyled-item">
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="w-100">
                                            <div class="skeleton-text xsm-w"></div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>  
                    <div class="row mt-5">
                        <div class="col-12 col-md-5 mb-3">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="card-title m-0">About</h6>
                                </div>
                                <div class="card-body">
                                    <?= csrf_field(); ?>
                                    <div class="bio" id="profile-info-bio">
                                        <ul class="list-unstyled skeleton-loading">
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2">
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2">
                                                    <div class="w-100">
                                                        <div class="skeleton-text sm-w"></div>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                    <hr>
                                    <div class="info" id="profile-info-list">
                                        <ul class="list-unstyled skeleton-loading">
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2 skeleton-with-icon">
                                                    <div class="icon w-auto">
                                                        <i class="skeleton-icon"></i>
                                                    </div>
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2 skeleton-with-icon">
                                                    <div class="icon w-auto">
                                                        <i class="skeleton-icon"></i>
                                                    </div>
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2 skeleton-with-icon">
                                                    <div class="icon w-auto">
                                                        <i class="skeleton-icon"></i>
                                                    </div>
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2 skeleton-with-icon">
                                                    <div class="icon w-auto">
                                                        <i class="skeleton-icon"></i>
                                                    </div>
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2 skeleton-with-icon">
                                                    <div class="icon w-auto">
                                                        <i class="skeleton-icon"></i>
                                                    </div>
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2 skeleton-with-icon">
                                                    <div class="icon w-auto">
                                                        <i class="skeleton-icon"></i>
                                                    </div>
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2 skeleton-with-icon">
                                                    <div class="icon w-auto">
                                                        <i class="skeleton-icon"></i>
                                                    </div>
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2 skeleton-with-icon">
                                                    <div class="icon w-auto">
                                                        <i class="skeleton-icon"></i>
                                                    </div>
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2 skeleton-with-icon">
                                                    <div class="icon w-auto">
                                                        <i class="skeleton-icon"></i>
                                                    </div>
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="list-unstyled-item">
                                                <div class="d-flex align-items-center gap-2 skeleton-with-icon">
                                                    <div class="icon w-auto">
                                                        <i class="skeleton-icon"></i>
                                                    </div>
                                                    <div class="w-100">
                                                        <div class="skeleton-text"></div>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="app-footer">
                <span>&copy; 2023 | ALIMS</span>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="updateAvatarModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Upload Avatar</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="preview-image-profile">
                    <img src="" id="img-profile">
                </div>
                <input type="file" name="file" id="file" class="form-control">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="control-update-avatar">Continue</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="updateBanner" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Upload Banner</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="preview-image-banner">
                    <img src="" id="img-profile">
                </div>
                <input type="file" name="file" id="file" class="form-control">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="control-update-banner">Continue</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="updateProfileDetails" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Update Details</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="#">
                    <?= csrf_field() ?>
                    <div class="row">
                        <div class="section-tle mb-3">
                            <h5>Personal Information</h5>
                            <small class="text-muted">All <span class="text-danger">*</span> are required</small>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label>First Name <span class="text-danger">*</span> </label>
                            <input type="text" name="firstname" id="firstname" class="form-control" placeholder="Please Wait...">
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label>Last Name <span class="text-danger">*</span> </label>
                            <input type="text" name="lastname" id="lastname" class="form-control" placeholder="Please Wait...">
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 col-md-4 mb-3">
                            <label>Email  <span class="text-danger">*</span> </label>
                            <input type="text" name="email" id="email" class="form-control" placeholder="Please Wait...">
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 col-md-4 mb-3">
                            <label>Contact <span class="text-danger">*</span> </label>
                            <input type="text" name="contact" id="contact" class="form-control" placeholder="Please Wait...">
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 col-md-4 mb-3">
                            <label>Gender <span class="text-danger">*</span> </label>
                            <select name="gender" id="gender" class="form-control">
                                <option value="">Choose</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label>Birthday <span class="text-danger">*</span> </label>
                            <input type="date" name="birthday" id="birthday"  min="1995-01-01" max="2005-12-31" class="form-control" pattern="\d{1,2}/\d{1,2}/\d{4}" placeholder="Birthday">
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label>Civil Status <span class="text-danger">*</span> </label>
                            <select name="status" id="status" class="form-control">
                                <option value="">Choose</option>
                                <option value="single">Single</option>
                                <option value="married">Married</option>
                            </select>
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 col-12 mb-3">
                            <label>Address <span class="text-danger">*</span> </label>
                            <input type="text" name="address" id="address" class="form-control" placeholder="Please Wait...">
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label>District/Province <span class="text-danger">*</span> </label>
                            <select name="state" id="state" class="form-control">
                                <option value="">Choose</option>
                            </select>
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label>City/Municipality <span class="text-danger">*</span> </label>
                            <select name="city" id="city" class="form-control">
                                <option value="">Select District / Province</option>
                            </select>
                            <small class="invalid-feedback"></small>
                        </div>
                    </div>
                    <div class="row">
                        <div class="section-tle mb-3">
                            <h5>Social Information</h5>
                        </div>
                        <div class="col-12 mb-3">
                            <label>Facebook Username </label>
                            <input type="text" name="fblink" id="fblink" class="form-control" placeholder="Not yet updated">
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 mb-3">
                            <label>Instagram Username </label>
                            <input type="text" name="iglink" id="iglink" class="form-control" placeholder="Not yet updated">
                            <small class="invalid-feedback"></small>
                        </div>
                        <div class="col-12 mb-3">
                            <label>Twitter Username </label>
                            <input type="text" name="twilink" id="twilink" class="form-control" placeholder="Not yet updated">
                            <small class="invalid-feedback"></small>
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="control-update-profile-details">Continue</button>
            </div>
        </div>
    </div>
</div>

<script type="module">

import { my, getJWTtoken } from "/assets/js/student/modules/dataUtils.js";
import { isEmpty, userRole, generateCSRFToken, toastMessage } from "/assets/js/student/modules/utils.js";
import { address } from "/assets/js/student/modules/address.js";
import {my_courses, my_subjects} from '/assets/js/student/modules/dataUtils.js';

viewMy();
address();
const response = await getJWTtoken();
const jwt_token = response.token;
const id = <?= $current_userdata['id']?>

function viewMy() {
    my().then((response) => {
        if(response.status == 200) {
            const data = response.data;
            console.log(data);
            let div = `
                <ul class="list-unstyled">
                    <li class="list-unstyled-item">
                        <div class="icon">
                            <i class='bx bxs-id-card'></i>
                            <span>#${data.id}</span>
                        </div>
                    </li>
                    <li class="list-unstyled-item">
                        <div class="icon">
                            <i class='bx bx-user'></i>
                            <span>${data.username}</span>
                        </div>
                    </li>
                    <li class="list-unstyled-item">
                        <div class="icon">
                            <i class='bx bx-home'></i>
                            <span>${isEmpty(data.city)}, ${isEmpty(data.province)}</span>
                        </div>
                    </li>
                    <li class="list-unstyled-item">
                        <div class="icon">
                            <i class='bx bx-heart'></i>
                            <span>${isEmpty(data.status)}</span>
                        </div>
                    </li>
                    <li class="list-unstyled-item">
                        <div class="icon">
                            <i class='bx bxs-cake'></i>
                            <span>${isEmpty((data.birthday))}</span>
                        </div>
                    </li>
                    <li class="list-unstyled-item">
                        <div class="icon">
                            <i class='bx bx-male-sign'></i>
                            <span>${isEmpty(data.gender)}</span>
                        </div>
                    </li>
                    <li class="list-unstyled-item">
                        <div class="icon">
                            <i class='bx bx-mobile'></i>
                            <span>${isEmpty(data.contact)}</span>
                        </div>
                    </li>
                    <li class="list-unstyled-item">
                        <div class="icon">
                            <i class='bx bxl-facebook-square'></i>
                            <span><a href="https://www.facebook.com/${data.fb_link}" class="text-lowercase">${isEmpty(data.fb_link)}</a></span>
                        </div>
                    </li>
                    <li class="list-unstyled-item">
                        <div class="icon">
                            <i class='bx bxl-instagram'></i>
                            <span><a href="https://www.instagram.com/${data.ig_link}" class="text-lowercase">${isEmpty(data.ig_link)}</a></span>
                        </div>
                    </li>
                    <li class="list-unstyled-item">
                        <div class="icon">
                            <i class='bx bxl-twitter'></i>
                            <span><a href="https://www.twitter.com/${data.twi_link}" class="text-lowercase">${isEmpty(data.twi_link)}</a></span>
                        </div>
                    </li>
                </ul>
                <button class="btn btn-primary w-100 mt-3" data-bs-toggle="modal" data-bs-target="#updateProfileDetails">Update Details</button>
            `;
            $('#profile-info-list').html(DOMPurify.sanitize(div));

            div = `
                <div>   
                    ${isEmpty(data.bio)}
                </div>
                <button class="btn btn-primary w-100 mt-3" id="toggle-update-bio">Update Bio</button>
            `;

            $('#profile-info-bio').html(DOMPurify.sanitize(div));

            div = `
                <h1 class="text-uppercase">${data.firstname + ' ' + data.lastname}</h1>
                <p class="text-uppercase">${userRole(data.role)}</span></p>
            `
            $('#profile-info').html(DOMPurify.sanitize(div));

            div = `
                <img src="/uploads/avatar/${data.avatar}" class="view-profile">
                <div class="action-overlay">
                    <button class="btn btn-primary w-100 mt-3 p-2" data-bs-toggle="modal" data-bs-target="#updateAvatarModal"><i class='bx bx-camera'></i></button>
                </div>
            `;

            $('#profile-image').html(DOMPurify.sanitize(div));
            
            div = `
                <img src="/uploads/banner/${data.banner}">
                <div class="banner-actions">
                    <button class="btn btn-primary" id="btn-update-banner" data-bs-toggle="modal" data-bs-target="#updateBanner"><i class='bx bx-camera'></i>Update Banner</button>
                </div>
            `;

            $('.banner-overlay').html(DOMPurify.sanitize(div));

            div = `
            <div>
                <img src="/uploads/avatar/${data.avatar}" id="img-profile">
            </div>
            <div>
                <div class="dropdown-toggle">${data.firstname + data.lastname}</div>
                <div>#${(data.id)}</div>
            </div>
            `;

            $('#navbar-profile').html(DOMPurify.sanitize(div));

            $('.preview-image-profile img').attr('src', `/uploads/avatar/${data.avatar}`);
            $('.preview-image-banner img').attr('src', `/uploads/banner/${data.banner}`);
            $('.site-header').removeClass('skeleton-image');

            // ADD TO MODAL

            $("#firstname").val(DOMPurify.sanitize(data.firstname.toUpperCase()));
            $("#lastname").val(DOMPurify.sanitize(data.lastname.toUpperCase()));
            $("#email").val(DOMPurify.sanitize(data.email));
            $("#contact").val(DOMPurify.sanitize(data.contact));
            $("#gender").val(DOMPurify.sanitize(data.gender)).attr('selected');
            $("#birthday").val(DOMPurify.sanitize(data.birthday));
            $("#status").val(DOMPurify.sanitize(data.status)).attr('selected');
            $("#address").val(DOMPurify.sanitize(data.address));
            $("#fblink").val(DOMPurify.sanitize(data.fblink));
            $("#iglink").val(DOMPurify.sanitize(data.iglink));
            $("#twilink").val(DOMPurify.sanitize(data.twilink));
        }
    });
}

my_courses(id).then((response) => {
    let div = '';
    if(response.status == 200) {
        const data = response.data;
        console.log(data);
        data.forEach((data) => {
            div += `
            <div class="col-12 col-md-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="text-capitalize fw-bold">${data.course_name}</h5>
                        <h6 class="mb-0 text-uppercase">${data.course_code}</h6>
                        <hr>
                        <small class="mb-0 d-block fw-bold text-muted text-uppercase">SATURDAY 10:00AM - 11:00AM</small>
                        <small class="mb-0 d-block fw-bold text-muted text-uppercase">${data.year_name} | ${data.section_name}</small>
                    </div>
                    <div class="card-footer w-100 d-flex justify-content-end gap-2">
                        <button class="btn btn-secondary">Masterlist</button>
                        <a href="/student/subjects?course=${data.course_id}&year=${data.year_id}&section=${data.section_id}" class="btn btn-primary">View Subjects</a>
                    </div>
                </div>
            </div>
            `;
        });

        $('#data-col').html(DOMPurify.sanitize(div));

        div = '';

        data.forEach((data) => {
            div += `
                
                <li>
                    <a href="/student/subjects?course=${data.course_id}&year=${data.year_id}&section=${data.section_id}">
                        <p class="d-block text-capitalize mb-1">${data.course_name}</p>
                        <small class="d-block text-uppercase">${data.course_code} </small>
                        <small class="d-block text-uppercase">${data.section_name} | ${data.year_name}</small>
                    </a>
                </li>
            `;
        });

        $('.treeview-menu.courses').append(DOMPurify.sanitize(div));

    }
});

my_subjects(id).then((response) => {
    let div = '';
    if(response.status == 200) {
        const data = response.data;

        data.forEach((data) => {
            div += `
                
                <li>
                    <a href="/student/subjects?course=${data.course_id}&year=${data.year_id}&section=${data.section_id}">
                        <p class="d-block text-capitalize mb-1">${data.subject_name}</p>
                        <small class="d-block text-uppercase">${data.course_code} - ${data.subject_code} </small>
                        <small class="d-block text-uppercase">${data.section_name} | ${data.year_name}</small>
                    </a>
                </li>
            `;
        });

        $('.treeview-menu.subjects').append(DOMPurify.sanitize(div));
    }
});

$(document).on('click', '#toggle-update-bio, #toggle-cancel-bio', function() {
    const isUpdate = $(this).attr('id') === 'toggle-update-bio';
    const div = isUpdate
        ? `<textarea class="form-control" id="bio-input" placeholder="Write here..." rows="5"></textarea>
            <button class="btn ${isUpdate ? 'btn-custom-dark' : 'btn-bordered'} w-100 mt-3" id="control-update-bio">Save</button>`
        : viewMy();

    $(this)
        .removeClass(isUpdate ? 'btn-custom-dark' : 'btn-bordered')
        .addClass(isUpdate ? 'btn-bordered' : 'btn-custom-dark')
        .text(isUpdate ? 'Discard' : 'Update Bio')
        .attr('id', isUpdate ? 'toggle-cancel-bio' : 'toggle-update-bio');
    $('.bio div').html(DOMPurify.sanitize(div));
});

$(document).on('click', '#control-update-bio', function() {
    const bio = $('#bio-input').val().trim();
    const csrf_token =  DOMPurify.sanitize($('input[name="csrf_token"]').val().trim());
    $.ajax({
        url: '/api/v1/my/bio',
        method: 'POST',
        dataType: 'JSON',
        data: {
            bio: bio,
        },
        beforeSend: function(xhr) {
            $(this).attr('disabled', true);
            xhr.setRequestHeader('Authorization', `Bearer ${jwt_token}`);
            xhr.setRequestHeader('X-CSRF-TOKEN', csrf_token);
        },
        success: function(response) {
            if(response.status === 200) {
                viewMy();
            }
        }
    }).done(function() {
        $(this).attr('disabled', false);
        generateCSRFToken();
    });
});

$('#control-update-profile-details').on('click', function() {
    
    const firstname = DOMPurify.sanitize($('#firstname').val().trim());
    const lastname = DOMPurify.sanitize($('#lastname').val().trim());
    const email = DOMPurify.sanitize($('#email').val().trim());
    const contact = DOMPurify.sanitize($('#contact').val().trim());
    const bithday = DOMPurify.sanitize($('#birthday').val().trim());
    const address = DOMPurify.sanitize($('#address').val().trim());
    const gender = DOMPurify.sanitize($('#gender').val().trim());
    const status = DOMPurify.sanitize($('#status').val().trim());
    const state = DOMPurify.sanitize($('#state').val().trim());
    const city = DOMPurify.sanitize($('#city').val().trim());
    const fb_link = DOMPurify.sanitize($('#fblink').val().trim());
    const ig_link = DOMPurify.sanitize($('#iglink').val().trim());
    const twi_link = DOMPurify.sanitize($('#twilink').val().trim());
    const csrf_token =  DOMPurify.sanitize($('input[name="csrf_token"]').val().trim());

    $.ajax({
        url: '/api/v1/my/info',
        method: 'POST',
        dataType: 'json',
        data: {
            firstname: firstname,
            lastname: lastname,
            email: email,
            contact: contact,
            birthday: bithday,
            address: address,
            gender: gender,
            status: status,
            state: state,
            city: city,
            fb_link: fb_link,
            ig_link: ig_link,
            twi_link: twi_link
        }, 
        beforeSend: function(xhr) {
            $(this).attr('disabled', true);
            xhr.setRequestHeader('Authorization', `Bearer ${jwt_token}`);
            xhr.setRequestHeader('X-CSRF-TOKEN', csrf_token);
        },
        success: function(response) {
            console.log(response);
            if(response.status == 200) {
                Swal.fire({
                    icon: 'success',
                    title: 'Yey..',
                    text: response.message,
                });
                viewMy();
            } else {
                let err = response.message;
                if(typeof err == 'object') {
                    err = Object.values(err);
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops..',
                        text: err[0],
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops..',
                        text: err,
                    });
                }
            }
        }
    }).done(function() {
        $(this).attr('disabled', false);
        $('.modal').modal('hide');
        generateCSRFToken();
    });

});

$('#updateAvatarModal #file').on('change', function() {
    const imgfilediv = $(this);
    const file = $(this).prop('files')[0];
    const reader = new FileReader();

    reader.onload = function(e) {
        $('.preview-image-profile img').attr('src', e.target.result);
        imgfilediv.val('');
    };
    reader.readAsDataURL(file);

    $('#control-update-avatar').on('click', function() {
        const formData = new FormData();
        const csrf_token =  DOMPurify.sanitize($('input[name="csrf_token"]').val().trim());
        formData.append('file', file);
        if(file != '') {
            $.ajax({
                url: '/api/v1/my/avatar',
                method: 'POST',
                contentType: false,
                processData: false,
                dataType: 'json',
                data: formData,
                beforeSend: function(xhr) {
                    $(this).attr('disabled', true);
                    xhr.setRequestHeader('Authorization', `Bearer ${jwt_token}`);
                    xhr.setRequestHeader('X-CSRF-TOKEN', csrf_token);
                },
                success: function(response) {
                    if(response.status == 200) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Yey..',
                            text: response.message,
                        });
                        viewMy();
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops..',
                            text: response.message[0],
                        });
                    }
                }
            }).done(function() {
                $(this).attr('disabled', false);
                $('.modal').modal('hide');
                generateCSRFToken();
            })
        }
    });
});

$('#updateBanner #file').on('change', function() {
    const imgfilediv = $(this);
    const file = $(this).prop('files')[0];
    const reader = new FileReader();
    reader.onload = function(e) {
        $('.preview-image-banner img').attr('src', e.target.result);
        imgfilediv.val('');
    };
    reader.readAsDataURL(file);

    $('#control-update-banner').on('click', function() {
        const formData = new FormData();
        const csrf_token =  DOMPurify.sanitize($('input[name="csrf_token"]').val().trim());
        formData.append('file', file);
        if(file != '') {
            $.ajax({
                url: '/api/v1/my/banner',
                method: 'POST',
                contentType: false,
                processData: false,
                dataType: 'json',
                data: formData,
                beforeSend: function(xhr) {
                    $(this).attr('disabled', true);
                    xhr.setRequestHeader('Authorization', `Bearer ${jwt_token}`);
                    xhr.setRequestHeader('X-CSRF-TOKEN', csrf_token);
                },
                success: function(response) {
                    if(response.status == 200) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Yey..',
                            text: response.message,
                        });
                        viewMy();
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops..',
                            text: response.message[0],
                        });
                    }
                }
            }).done(function() {
                $(this).attr('disabled', false);
                $('.modal').modal('hide');
                generateCSRFToken();
            })
        }
    });
});


</script>